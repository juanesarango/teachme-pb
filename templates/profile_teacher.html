{% extends "base_main.html" %}
{% block title %}
	{{user.name}} {{user.lname}} | Teachme
{% endblock %}
{% block body %}

	<div class="backgnd" style="background-image: url('/static/profile.jpg')">
		<br>
		<br>
		<div class="container">
			<div class="row">
				<br>
				<br>
				<div class="col-md-10 col-md-offset-1 bckg-w-80">
					<div class="row">
						<div class="col-md-3 col-md-offset-1">
							<br>
							<img class="img-circle img-100" {% if teacher.profile_pic_r %}src="{{teacher.profile_pic_r}}"{% else %} src="/static/avatar.png"{% endif %}>
							<h2>{{teacher.name}}</h2>
							<h3>{{teacher.lname}}</h3>
							<div class="row">
								<div class="col-md-12">
									<form role="form" method="post" action="{{upload_url}}" enctype="multipart/form-data">
										<div class="form-group">
											<input type="hidden" name="te_id" value="{{teacher.key.id()}}">
											<label for="t-profile_pic">Foto de perfil</label>
											<input type="file" name="profile_pic" accept="image/*" id="t-profile_pic">
											<p class="help-block">Te recomendamos una foto de 140x140 píxeles</p>
										</div>
										<button type="submit" class="btn btn-success">Actualizar foto</button>
									</form>
								</div>
							</div>
						</div>
						<div class="col-md-7">
							<h2>Acerca de ti</h2>
							<!--  -->
							<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Editar<b class="caret"></b></a>
								<ul class="dropdown-menu min-width-300">
									<li>
										<a>
											<form method="post" action="/editabout" role="form">
												<label for="t-editabout">Acerca de ti:</label>
												<textarea name="editabout" class="form-control" id="t-editabout" rows="6" placeholder="Edita la información sobre tu perfil, intereses y motivaciones" required></textarea>
												<input type="hidden" name="te_id" value="{{teacher.key.id()}}">	
												<button type="submit" class="btn btn-success">Editar</button>
											</form>
										</a>
									</li>
								</ul>
							</li>
							<!--  -->
							<p>{{teacher.about}}</p>
						</div>
					</div>
					<hr>
					<div class="row">
						<div class="col-md-5 col-md-offset-1">
							<h3>Ciudad</h3>
							<p>{{teacher.ciudad}}</p>
							<h3>País</h3>
							<p>{{teacher.pais}}</p>
							<h3>Perfil de linkedin</h3>
							<p><a href="{{teacher.linkedin}}" target="_blank">{{teacher.linkedin}}</a></p>
						</div>
						<div class="col-md-5">
							<h3>Áreas del conocimiento</h3>
							{% for a in t_areas %}
								<p>{{a}}</p>
							{% endfor %}
						</div>
					</div>
					<hr>
					<div class="row">
						<div class="col-md-4 col-md-offset-1">
							<form role="form" method="post" action="/calendar/teacher/add">
								<h3>Ingresa tus horas disponibles</h3>
								<input type="datetime-local" step="1800" id="datetime">
								<input type="hidden" name="te_id" value="{{teacher.key.id()}}">
								<input type="hidden" name = "dateto" id="dateto_target">
								<p class="help-block">Escoge el día y la hora que tienes libre para dar asesorias</p>
								<button class="btn btn-success" type="submit">Estoy disponible</button>
							</form>
						</div>
						<div class="col-md-4">
							<h3>Agenda libre</h3>
							<div id="calendario">
								
							</div>
						</div>
						<div class="col-md-2">
							<h3>Horas disponibles</h3>
							<div id="horas">
								
							</div>
						</div>
					</div>
					<br>
				</div>
			</div>
		</div>	
	</div>
	<script type="text/javascript">
		$(document).ready(function() {
			$.datepicker.regional['es'] = {
		        closeText: 'Cerrar',
		        prevText: '<Ant',
		        nextText: 'Sig>',
		        currentText: 'Hoy',
		        monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
		        monthNamesShort: ['Ene','Feb','Mar','Abr', 'May','Jun','Jul','Ago','Sep', 'Oct','Nov','Dic'],
		        dayNames: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
		        dayNamesShort: ['Dom','Lun','Mar','Mié','Juv','Vie','Sáb'],
		        dayNamesMin: ['Do','Lu','Ma','Mi','Ju','Vi','Sá'],
		        weekHeader: 'Sm',
		        dateFormat: 'yy-m-d',
		        firstDay: 1,
		        isRTL: false,
		        showMonthAfterYear: false,
		        yearSuffix: ''
		    };

		    var fechas = {{fechas|safe}};
		    var dates_local = [];
		    var hours_local = {};
		    for (var f = 0; f < fechas.length; f++){

		    	var dt = new Date(fechas[f]);
		    	
		    	var str_dt = dt.getFullYear().toString()+'-'+(dt.getMonth()+1).toString()+'-'+dt.getDate().toString();
		    	
		    	if (dates_local.indexOf(str_dt)>=0){}
		    	else{
		    		dates_local.push(str_dt);
		    	}
		    	
		    	
		    	if (hours_local.hasOwnProperty(str_dt)){
		    		hours_local[str_dt].push(dt.toLocaleTimeString());
		    	} else {
		    		hours_local[str_dt] = [dt.toLocaleTimeString()];
		    	}
		    };

		    var dates = dates_local;
		    var hours = hours_local;
		    var today = new Date();
		    var cd = today.getFullYear().toString()+'-'+(today.getMonth()+1).toString()+'-'+today.getDate().toString(); 
		    $("#horas").replaceWith( function(){
		    	var s = "<div id='horas'> <h3>"+ cd +"</h3>";
		    	if(cd in hours){
		    		for (var h = 0; h < hours[cd].length; h++) {
		    		s = s+"<p class='lead'>"+hours[cd][h]+"</p class='lead'>";
		    		};
		   		};
		    	
		    	s = s+"</div";
		    	return s;
		    });

			$.datepicker.setDefaults( $.datepicker.regional[ "es" ] );
			$('#calendario').datepicker({
				beforeShowDay : function(date){
					var y = date.getFullYear().toString(); // get full year
					var m = (date.getMonth() + 1).toString(); // get month.
					var d = date.getDate().toString(); // get Day
					var currDate = y+'-'+m+'-'+d;
					if(dates.indexOf(currDate) >= 0){
						return [true,"ui-highlight", ""];	
					}else{
						return [false];
					}					
				},
				onSelect : function(date){
					$("#horas").replaceWith( function(){
		    			var s = "<div id='horas'> <h3>"+date+"</h3>";
		    			for (var h = 0; h < hours[date].length; h++) {
		    				s = s+"<p class='lead'>"+hours[date][h]+"</p class='lead'>";
		    			};
		    			s = s+"</div";
		    			return s;
					});
				},

			});
			$('#datetime').change(function(){
				var str = $(this).val().replace('T', " ");
				var date = new Date(str);
				var UTCdate = date.getUTCFullYear()+"-"+(parseInt(date.getUTCMonth())+1).toString()+"-"+date.getUTCDate()+" "+date.getUTCHours()+":"+date.getUTCMinutes();
				$('#dateto_target').val(UTCdate);

			})
		});
	</script>

{% endblock %}

